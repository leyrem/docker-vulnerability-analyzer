package utils

import (
	"strings"

	"github.com/leyrem/docker-vulnerability-analyzer/outputdata"
)

func containsLinear(arr []string, target string) bool {
	for _, v := range arr {
		if v == target {
			return true
		}
	}
	return false
}

func HasDuplicates(cs []outputdata.CVE) []string {
	dups := []string{}
	seen := make(map[string]bool)
	for _, c := range cs {
		str := c.CVE_ID + "-" + c.Package
		if seen[str] {
			if !containsLinear(dups, str) {
				dups = append(dups, str)
			}
		}
		seen[str] = true
	}
	return dups
}

func ExtractSeverityValueTrivy(input string) string {
	// Split the input string by newline
	lines := strings.Split(input, "\n")

	// Iterate through each line
	for _, line := range lines {
		if strings.HasPrefix(line, "Severity:") {
			// Split the line by ": " to separate the key and the value
			parts := strings.SplitN(line, ": ", 2)
			if len(parts) == 2 {
				return parts[1]
			}
		}
	}
	return "" // Return an empty string if "Severity:" is not found or improperly formatted
}

func ExtractComponentSnyk(input string) string {
	// Find the index of the first occurrence of ')' in the string
	startIndex := strings.Index(input, ")")

	if startIndex == -1 {
		return "" // If ')' is not found, return empty string
	}

	// Extract the substring after ')' (including the space after ')')
	substr := input[startIndex+2:] // startIndex+2 to skip ')' and the space

	return substr
}

func SplitByThirdHyphen(s string) (string, string) {
	count := 0
	index := -1

	// Iterate through the string to find the index of the third occurrence of '-'
	for i, char := range s {
		if char == '-' {
			count++
			if count == 3 {
				index = i
				break
			}
		}
	}

	// If there are fewer than three hyphens, return the original string and an empty string
	if index == -1 {
		return s, ""
	}

	// Split the string at the third hyphen
	before := s[:index]
	after := s[index+1:]

	return before, after
}
